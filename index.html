<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Terminal CIPNET</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box }
    body, html { width:100%; height:100%; background:#000; color:#0f0; font-family:monospace; overflow:hidden }

    /* Scanline */
    #screen::before {
      content:""; pointer-events:none;
      position:absolute; top:0;left:0;width:100%;height:100%;
      background:repeating-linear-gradient(
        rgba(0,0,0,0.1) 0, rgba(0,0,0,0.1) 1px,
        transparent 1px, transparent 3px
      );
      mix-blend-mode:multiply;
      animation:glitch 0.3s infinite alternate;
    }
    @keyframes glitch{0%{transform:translate(0,0)}100%{transform:translate(1px,1px)}}

    /* Container */
    #screen { position:relative; width:100%; height:100%; padding:20px; white-space:pre-wrap }

    .input { background:transparent; border:none; border-bottom:1px solid #0f0; color:#0f0; outline:none }

    /* Maze & Grid */
    #mazeCanvas { display:block; margin:20px auto; background:#000 }
    #keyGrid { display:flex; justify-content:center; flex-wrap:wrap; gap:10px; margin-top:20px }
    .key-cell { width:50px; height:50px; border:1px solid #0f0; display:flex; align-items:center; justify-content:center }
  </style>
</head>
<body>
  <div id="screen"></div>
  <script>
  document.addEventListener('DOMContentLoaded',()=>{

    const screen = document.getElementById('screen');
    let state = 0, menuIdx = 0;
    const initialText = 'run CIPNET';
    let idxChar = 0;

    // Animação inicial de digitação
    function typeInitial() {
      if (idxChar < initialText.length) {
        screen.textContent += initialText[idxChar++];
        setTimeout(typeInitial, 100);
      } else {
        setTimeout(showRunning, 300);
      }
    }
    typeInitial();

    // “Running…”, logo ASCII e senha
    function showRunning(){
      screen.textContent = 'Running CIPNET.EXE...';
      setTimeout(()=>{
        screen.textContent = '\n' +
`   ____ ___ ___ _   _ _   _ 
  |  _ \\_ _/ __| | | | \\ | |
  | |_) | | (_ | |_| |  \\| |
  |____/___\\___|\\___/|_|\\_|
`;
        setTimeout(showPassword, 800);
      },800);
    }

    function showPassword(){
      state = 1;
      screen.textContent = '\nPOR FAVOR, INSIRA SUA SENHA:\n';
      const inp = document.createElement('input');
      inp.type='password'; inp.maxLength=5; inp.className='input';
      screen.appendChild(inp);
      inp.focus();
      inp.addEventListener('keydown', e=>{
        if(e.key==='Enter') checkPassword(inp.value);
      });
    }

    function checkPassword(val){
      if(val==='1973') showMenu();
      else if(val==='55555') showAdmin();
      else {
        screen.textContent='SENHA INVÁLIDA.\nTENTE NOVAMENTE.';
        setTimeout(showPassword,800);
      }
    }

    function showAdmin(){
      screen.textContent = '*** PAINEL ADMINISTRADOR ***\n(Em desenvolvimento)';
    }

    // Menu Principal
    const menuItems = ['DIREÇÃO DE SISTEMAS','DESENVOLVIMENTO TECNOLÓGICO','ARQUIVOS'];
    function showMenu(){
      state=2; menuIdx=0; renderMenu();
      document.addEventListener('keydown', menuNav);
    }
    function renderMenu(){
      screen.textContent = 'BEM VINDO!\nESCOLHA A FUNÇÃO NECESSÁRIA:\n\n';
      menuItems.forEach((it,i)=>{
        screen.textContent += (i===menuIdx?'▶ ':'  ') + '>' + it + '\n';
      });
    }
    function menuNav(e){
      if(state!==2) return;
      if(e.key==='ArrowUp')   menuIdx=(menuIdx+menuItems.length-1)%menuItems.length, renderMenu();
      if(e.key==='ArrowDown') menuIdx=(menuIdx+1)%menuItems.length,         renderMenu();
      if(e.key==='Enter'){
        document.removeEventListener('keydown', menuNav);
        if(menuIdx===0) showDesktop3();
        if(menuIdx===1) showPuzzleFlow();
        if(menuIdx===2) showFiles();
      }
    }

    // Desktop 3
    function showDesktop3(){
      state=3; let idx=0;
      const opts=['CLONAR CARTÃO DE ACESSO','ACESSAR SISTEMAS','OUTROS'];
      function draw(){
        screen.textContent = 'CARREGANDO SISTEMA...\n\nSELECIONE TRAJETÓRIA:\n\n';
        opts.forEach((o,i)=>{
          screen.textContent += (i===idx?'▶ ':'  ') + '>' + o + '\n';
        });
      }
      draw();
      document.addEventListener('keydown',nav);
      function nav(e){
        if(e.key==='ArrowUp')   idx=(idx+opts.length-1)%opts.length, draw();
        if(e.key==='ArrowDown') idx=(idx+1)%opts.length,          draw();
        if(e.key==='Enter'){
          document.removeEventListener('keydown',nav);
          showPuzzleFlow();
        }
      }
    }

    // Fluxo Puzzle (labirinto + grid)
    function showPuzzleFlow(){
      showMaze(15,15);
    }

    // Labirinto procedural
    function showMaze(cols, rows){
      state=4; screen.innerHTML='';
      const canvas = document.createElement('canvas');
      const size = Math.min(window.innerWidth,window.innerHeight) - 100;
      canvas.width = canvas.height = size;
      canvas.id = 'mazeCanvas';
      screen.appendChild(canvas);
      const ctx = canvas.getContext('2d');
      const w = size/cols, h = size/rows;
      const grid = [], stack = [];
      for(let x=0;x<cols;x++){
        grid[x]=[];
        for(let y=0;y<rows;y++){
          grid[x][y]={x,y,vis:false, walls:[true,true,true,true]};
        }
      }
      let current = grid[0][0];
      current.vis=true; stack.push(current);

      function carve(){
        if(stack.length){
          const cur = stack.pop(), {x,y} = cur;
          const neighbors = [];
          [[0,-1,0],[1,0,1],[0,1,2],[-1,0,3]].forEach(([dx,dy,dir])=>{
            const nx=x+dx, ny=y+dy;
            if(nx>=0&&nx<cols&&ny>=0&&ny<rows && !grid[nx][ny].vis){
              neighbors.push({cell:grid[nx][ny], dir});
            }
          });
          if(neighbors.length){
            stack.push(cur);
            const pick = neighbors[Math.floor(Math.random()*neighbors.length)];
            cur.walls[pick.dir]=false;
            pick.cell.walls[(pick.dir+2)%4]=false;
            pick.cell.vis=true;
            stack.push(pick.cell);
          }
          draw();
          requestAnimationFrame(carve);
        } else {
          setTimeout(showKeyGrid,300);
        }
      }

      function draw(){
        ctx.fillStyle='#000'; ctx.fillRect(0,0,size,size);
        ctx.fillStyle='#0f0';
        for(let x=0;x<cols;x++){
          for(let y=0;y<rows;y++){
            const cell = grid[x][y];
            const X=x*w, Y=y*h;
            if(cell.walls[0]) ctx.fillRect(X,Y,w,2);
            if(cell.walls[1]) ctx.fillRect(X+w-2,Y,2,h);
            if(cell.walls[2]) ctx.fillRect(X,Y+h-2,w,2);
            if(cell.walls[3]) ctx.fillRect(X,Y,2,h);
          }
        }
      }

      carve();
    }

    // Grid de teclas
    function showKeyGrid(){
      screen.innerHTML = 'PUZZLE 2: pressione simultâneo:\n';
      const keys = ['Shift','A','5'];
      const div = document.createElement('div');
      div.id = 'keyGrid';
      keys.forEach(k=>{
        const cell = document.createElement('div');
        cell.className='key-cell'; cell.textContent=k;
        div.appendChild(cell);
      });
      screen.appendChild(div);

      const pressed = {};
      document.addEventListener('keydown', down);
      document.addEventListener('keyup', up);

      function down(e){
        pressed[e.key] = true;
        if(keys.every(k=>pressed[k])) finish();
      }
      function up(e){ pressed[e.key]=false; }

      function finish(){
        document.removeEventListener('keydown',down);
        document.removeEventListener('keyup',up);
        screen.textContent = 'Puzzle resolvido com sucesso.\nCódigo: ' +
          Math.random().toString(36).substr(2,4).toUpperCase()+'-'+
          Math.random().toString(36).substr(2,4).toUpperCase()+
          '\n\nPressione Enter para continuar.';
        document.addEventListener('keydown', e=>{
          if(e.key==='Enter') showFinal();
        });
      }
    }

    // Resultado e reinício
    function showFinal(){
      screen.textContent = '--- RESULTADO ---\nConteúdo exibido aqui.\n\nPressione qualquer tecla para reiniciar.';
      document.addEventListener('keydown', ()=>location.reload());
    }

    // Arquivos (stub)
    function showFiles(){
      screen.textContent = 'CARREGANDO SISTEMA...\n\n>ARQUIVOS TÉCNICOS\n>RELATÓRIOS INTERNOS\n>PROTOCOLOS DE CAMPO\n\n(stub)';
    }

  });
  </script>
</body>
</html>
